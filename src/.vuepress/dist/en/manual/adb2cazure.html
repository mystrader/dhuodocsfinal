<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AD B2C - Provisionamento Azure | DhuoDocs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="A powerful system to manage your APIs">
    <meta name="theme-color" content="#8E3CCB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.80991633.css" as="style"><link rel="preload" href="/assets/js/app.e8dceb60.js" as="script"><link rel="preload" href="/assets/js/2.a347ed34.js" as="script"><link rel="preload" href="/assets/js/15.927014ea.js" as="script"><link rel="prefetch" href="/assets/js/10.b6b39271.js"><link rel="prefetch" href="/assets/js/11.75dbce17.js"><link rel="prefetch" href="/assets/js/12.abccc2e6.js"><link rel="prefetch" href="/assets/js/13.6b6fa392.js"><link rel="prefetch" href="/assets/js/14.c4530e4c.js"><link rel="prefetch" href="/assets/js/16.526dc2df.js"><link rel="prefetch" href="/assets/js/17.1dc7c310.js"><link rel="prefetch" href="/assets/js/18.42ba364a.js"><link rel="prefetch" href="/assets/js/19.49831e13.js"><link rel="prefetch" href="/assets/js/20.e8b0308f.js"><link rel="prefetch" href="/assets/js/21.35d8b9e2.js"><link rel="prefetch" href="/assets/js/22.ba7ebc2f.js"><link rel="prefetch" href="/assets/js/23.f2cd6189.js"><link rel="prefetch" href="/assets/js/3.80700dba.js"><link rel="prefetch" href="/assets/js/4.10668c80.js"><link rel="prefetch" href="/assets/js/5.bd26d954.js"><link rel="prefetch" href="/assets/js/6.6a41b796.js"><link rel="prefetch" href="/assets/js/7.0dd21078.js"><link rel="prefetch" href="/assets/js/8.82f4b19a.js"><link rel="prefetch" href="/assets/js/9.2dd29679.js">
    <link rel="stylesheet" href="/assets/css/0.styles.80991633.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><!----> <span class="site-name">DhuoDocs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/manual/" class="nav-link">
  Manuais
</a></div><div class="nav-item"><a href="/links/" class="nav-link">
  Links
</a></div><div class="nav-item"><a href="https://www.engdb.com.br/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Engineering
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/manual/adb2cazure.html" class="nav-link">
  pt-BR
</a></li><li class="dropdown-item"><!----> <a href="/en/manual/adb2cazure.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/mystrader/dhuodocsfinal.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/manual/" class="nav-link">
  Manuais
</a></div><div class="nav-item"><a href="/links/" class="nav-link">
  Links
</a></div><div class="nav-item"><a href="https://www.engdb.com.br/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Engineering
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/manual/adb2cazure.html" class="nav-link">
  pt-BR
</a></li><li class="dropdown-item"><!----> <a href="/en/manual/adb2cazure.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/mystrader/dhuodocsfinal.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ad-b2c-provisionamento-azure"><a href="#ad-b2c-provisionamento-azure" class="header-anchor">#</a> AD B2C - Provisionamento Azure</h1> <p></p><div class="table-of-contents"><ul><li><a href="#tabela-de-propriedades">Tabela de propriedades</a></li><li><a href="#tenant-padrao-default-directory">Tenant padrão (Default directory)</a><ul><li><a href="#obtencao-do-primary-domain">Obtenção do Primary domain</a></li><li><a href="#registro-de-resource-providers">Registro de Resource providers</a></li><li><a href="#criacao-de-resource-group">Criação de Resource group</a></li><li><a href="#cadastro-do-tenant-b2c">Cadastro do tenant b2c</a></li><li><a href="#app-insights">App Insights</a></li><li><a href="#app-para-login-de-usuarios-no-azure-ad-nao-b2c-apione-internal-user">App para login de usuários no Azure AD (não B2C) - apione-internal-user</a></li></ul></li><li><a href="#tenant-b2c">Tenant B2C</a><ul><li><a href="#obtencao-do-primary-domain-e-tenant-id">Obtenção do Primary domain e Tenant ID</a></li><li><a href="#app-ms-graph">App MS Graph</a></li><li><a href="#app-identityexperienceframework">App IdentityExperienceFramework</a></li><li><a href="#app-proxyidentityexperienceframework">App ProxyIdentityExperienceFramework</a></li><li><a href="#app-apione">App apione</a></li><li><a href="#app-apione-viaapi-web">App apione viaapi-web</a></li><li><a href="#app-apione-apimanagement-devportal-web">App apione apimanagement-devportal-web</a></li><li><a href="#app-b2c-extensions-app">app b2c-extensions-app</a></li></ul></li><li><a href="#configuracao-identity-experience-framework">Configuração Identity Experience Framework</a><ul><li><a href="#b2c-1a-adminclientencryptionkeycontainer">B2C1AAdminClientEncryptionKeyContainer</a></li><li><a href="#b2c-1a-tokensigningkeycontainer">B2C1ATokenSigningKeyContainer</a></li><li><a href="#b2c-1a-tokenencryptionkeycontainer">B2C1ATokenEncryptionKeyContainer</a></li><li><a href="#b2c-1a-googlesecret">B2C1AGoogleSecret</a></li><li><a href="#b2c-1a-facebooksecret">B2C1AFacebookSecret</a></li><li><a href="#b2c-1a-getusergroupsrestapiusername">B2C1AGetUserGroupsRestApiUsername</a></li><li><a href="#b2c-1a-getusergroupsrestapipassword">B2C1AGetUserGroupsRestApiPassword</a></li><li><a href="#b2c-1a-azureadsecret">B2C1AAzureADSecret</a></li></ul></li><li><a href="#roles">Roles</a></li><li><a href="#groups">Groups</a></li></ul></div><p></p> <h2 id="tabela-de-propriedades"><a href="#tabela-de-propriedades" class="header-anchor">#</a> Tabela de propriedades</h2> <p>Durante a instalação serão gerados IDs e propriedades que serão utilizados em configurações de diversos pontos. Para isso recomenda-se utilizar a tabela de propriedades abaixo e armazenar os valores em um arquivo para uso posterior e melhor orientação.</p> <p><strong>Atenção:</strong> Alguns valores, como as secrets, só são visíveis no momento do cadastro.</p> <table><thead><tr><th>propriedade</th> <th></th></tr></thead> <tbody><tr><td>defaultTenant.PrimaryDomain</td> <td></td></tr> <tr><td>defaultTenant.app.ApplicationInsights.InstrumentationKey</td> <td></td></tr> <tr><td>defaultTenant.app.InternalUser.clientId</td> <td></td></tr> <tr><td>defaultTenant.app.InternalUser.secret</td> <td></td></tr> <tr><td>b2cTenant.Name</td> <td></td></tr> <tr><td>b2cTenant.TenantId</td> <td></td></tr> <tr><td>b2cTenant.PrimaryDomain</td> <td></td></tr> <tr><td>b2cTenant.app.MsGraph.clientId</td> <td></td></tr> <tr><td>b2cTenant.app.MsGraph.secret</td> <td></td></tr> <tr><td>b2cTenant.app.IdentityExperienceFramework.clientId</td> <td></td></tr> <tr><td>b2cTenant.app.ProxyIdentityExperienceFramework.clientId</td> <td></td></tr> <tr><td>b2cTenant.app.Apione.EnterpriseApplication.objectId</td> <td></td></tr> <tr><td>b2cTenant.app.Viaapiweb.clientId</td> <td></td></tr> <tr><td>b2cTenant.app.Devportalweb.clientId</td> <td></td></tr> <tr><td>b2cTenant.app.Devportalweb.secret</td> <td></td></tr> <tr><td>b2cTenant.app.B2CExtensionsApp.clientId</td> <td></td></tr> <tr><td>b2cTenant.app.B2CExtensionsApp.objectId</td> <td></td></tr> <tr><td>b2cTenant.PolicyKeys.RestApiUsername</td> <td></td></tr> <tr><td>b2cTenant.PolicyKeys.RestApiPassword</td> <td></td></tr></tbody></table> <h2 id="tenant-padrao-default-directory"><a href="#tenant-padrao-default-directory" class="header-anchor">#</a> Tenant padrão (Default directory)</h2> <p>Todos os passos dessa seção devem ser executados no tenant default da subscription Azure.</p> <h3 id="obtencao-do-primary-domain"><a href="#obtencao-do-primary-domain" class="header-anchor">#</a> Obtenção do Primary domain</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>Overview</strong>, obter o Primary domain</li> <li>Atribuir à propriedade <strong>defaultTenant.PrimaryDomain</strong> da tabela de propriedades o Primary domain obtido anteriormente.</li></ul> <h3 id="registro-de-resource-providers"><a href="#registro-de-resource-providers" class="header-anchor">#</a> Registro de Resource providers</h3> <ul><li>Na página inicial do portal, busque por e selecione Subscriptions</li> <li>Selecione sua subscription</li> <li>No menu lateral acesse Resource providers</li> <li>Busque por Microsoft.AzureActiveDirectory</li> <li>Selecione e clique em Register</li></ul> <h3 id="criacao-de-resource-group"><a href="#criacao-de-resource-group" class="header-anchor">#</a> Criação de Resource group</h3> <ul><li>Na página inicial do portal, busque por e selecione Resource groups</li> <li>Crie um resource group que será usado para associar ao tenant b2c. Exemplo: dhuo</li></ul> <h3 id="cadastro-do-tenant-b2c"><a href="#cadastro-do-tenant-b2c" class="header-anchor">#</a> Cadastro do tenant b2c</h3> <ul><li>Na página inicial do portal, selecione Create a resource</li> <li>Busque por Azure Active Directory B2C</li> <li>Crie um tenant b2c com as seguintes propriedades:
<ul><li>Organization name: defina um nome para o tenant b2c. Exemplo: dhuo.</li> <li>Initial domain name: defina um nome para o domínio do tenant b2c. Exemplo: dhuo.</li> <li>Subscription: selecione a subscription desejada.</li> <li>Resource group: selecione o resource group criado anteriormente.</li></ul></li> <li>Revise e confirme</li> <li>Atribuir à propriedade <strong>b2cTenant.Name</strong> da tabela de propriedades o Initial domain name definido anteriormente.</li></ul> <h3 id="app-insights"><a href="#app-insights" class="header-anchor">#</a> App Insights</h3> <ul><li>Na página inicial do portal, busque por e selecione Application Insights</li> <li>Selecione <strong>Create</strong></li> <li>Crie um Application Insights com as seguintes propriedades:
<ul><li>Subscription: selecione a subscription desejada.</li> <li>Resource group: selecione o resource group criado anteriormente.</li> <li>Name: apione</li> <li>Region: selecione uma região de preferência</li> <li>Resource Mode: Workspace-based</li></ul></li> <li>Revise e confirme</li> <li>Aguarde o provisionamento</li> <li>Na página inicial do portal, busque por e selecione Application Insights</li> <li>Busque e selecione o app criado anteriormente</li> <li>Em <strong>Overview</strong>, obter o Instrumentation Key</li> <li>Atribuir à propriedade <strong>defaultTenant.app.ApplicationInsights.InstrumentationKey</strong> da tabela de propriedades o Instrumentation Key obtido anteriormente.</li></ul> <h3 id="app-para-login-de-usuarios-no-azure-ad-nao-b2c-apione-internal-user"><a href="#app-para-login-de-usuarios-no-azure-ad-nao-b2c-apione-internal-user" class="header-anchor">#</a> App para login de usuários no Azure AD (não B2C) - apione-internal-user</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>App registrations</strong>, selecionar <strong>New registration</strong></li> <li>Crie um App com as seguintes propriedades:
<ul><li>Name: apione-internal-user</li> <li>Supported account types: Accounts in this organizational directory only</li> <li>Redirect URI: (Web) https://{b2cTenant.Name}.b2clogin.com/{b2cTenant.Name}.onmicrosoft.com/oauth2/authresp</li></ul></li> <li>Registrar</li> <li>Na página do app criado (Overview), obter o Application (client) ID</li> <li>Atribuir à propriedade <strong>defaultTenant.app.InternalUser.clientId</strong> da tabela de propriedades o Application (client) ID obtido anteriormente.</li></ul> <p><strong>Permissions</strong></p> <ul><li>Em <strong>API permissions</strong>, selecionar <strong>Add a permission</strong> &gt; Microsoft APIs &gt; Microsoft Graph &gt; Delegated permissions</li> <li>Buscar e selecionar a permission <strong>openid</strong></li> <li>Add permissions</li> <li>Em <strong>API permissions</strong>, selecionar <strong>Add a permission</strong> &gt; Microsoft APIs &gt; Microsoft Graph &gt; Delegated permissions</li> <li>Buscar e selecionar a permission <strong>offiline_access</strong></li> <li>Add permissions</li> <li>Selecione <strong>Grant admin consent for &lt;diretório&gt;</strong></li> <li>Confirme e aguarde a atribuição de permissões</li></ul> <p><strong>Secret</strong></p> <ul><li>Em <strong>Certificates &amp; secrets</strong>, selecionar <strong>New client secret</strong></li> <li>Crie um secret com as seguintes propriedades:
<ul><li>Description: apione-secret</li> <li>Expires: 24 months</li></ul></li> <li>Add</li> <li>Após criada, obter o Value gerado</li> <li>Atribuir à propriedade <strong>defaultTenant.app.InternalUser.secret</strong> da tabela de propriedades o Value obtido anteriormente.
<strong>Atenção:</strong> o valor da secret Só poderá ser visto por inteiro quando criado.</li></ul> <h2 id="tenant-b2c"><a href="#tenant-b2c" class="header-anchor">#</a> Tenant B2C</h2> <p>Todos os passos dessa seção devem ser executados no tenant b2c da subscription Azure.</p> <ul><li>Certifique-se que esteja no tenant b2c</li> <li>Caso não esteja, vá no menu de usuário e selecione a opção <strong>Switch directory</strong> e, na tela seguinte, troque para o diretório do tenant b2c</li></ul> <h3 id="obtencao-do-primary-domain-e-tenant-id"><a href="#obtencao-do-primary-domain-e-tenant-id" class="header-anchor">#</a> Obtenção do Primary domain e Tenant ID</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>Overview</strong>, obter o Tenant ID</li> <li>Atribuir à propriedade <strong>b2cTenant.TenantId</strong> da tabela de propriedades o Primary domain obtido anteriormente.</li> <li>Em <strong>Overview</strong>, obter o Primary domain</li> <li>Atribuir à propriedade <strong>b2cTenant.PrimaryDomain</strong> da tabela de propriedades o Primary domain obtido anteriormente.</li></ul> <h3 id="app-ms-graph"><a href="#app-ms-graph" class="header-anchor">#</a> App MS Graph</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>App registrations</strong>, selecionar <strong>New registration</strong></li> <li>Crie um App com as seguintes propriedades:
<ul><li>Name: apione-msgraph</li> <li>Supported account types: Accounts in this organizational directory only</li> <li>Redirect URI: deixar em branco</li> <li>Permissions: Grant admin consent to openid and offline_access permissions</li></ul></li> <li>Registrar</li> <li>Na página do app criado (Overview), obter o Application (client) ID</li> <li>Atribuir à propriedade <strong>b2cTenant.app.MsGraph.clientId</strong> da tabela de propriedades o Application (client) ID obtido anteriormente.</li></ul> <p><strong>Authentication</strong></p> <ul><li>Em <strong>Authentication</strong>, Advanced settings, marcar <strong>Enable the following mobile and desktop flows</strong>: Yes</li> <li>Selecione Save</li></ul> <p><strong>Permissions</strong></p> <ul><li>Em <strong>API permissions</strong>, selecionar <strong>Add a permission</strong> &gt; Microsoft APIs &gt; Microsoft Graph &gt; Application permissions</li> <li>Buscar e selecionar as permissions
<ul><li>Application.Read.All</li> <li>Application.ReadWrite.All</li> <li>Application.ReadWrite.OwnedBy</li> <li>AppRoleAssignment.ReadWrite.All</li> <li>Directory.Read.All</li> <li>Directory.ReadWrite.All</li> <li>User.Read.All</li> <li>User.ReadWrite.All</li> <li>Group.ReadWrite.All</li> <li>AuditLog.Read.All</li> <li>Policy.ReadWrite.TrustFramework</li></ul></li> <li>Add permissions</li> <li>Em <strong>API permissions</strong>, selecionar <strong>Add a permission</strong> &gt; Microsoft APIs &gt; Microsoft Graph &gt; Delegated permissions</li> <li>Buscar e selecionar a permission <strong>Policy.ReadWrite.TrustFramework</strong></li> <li>Add permissions</li> <li>Selecione <strong>Grant admin consent for &lt;diretório&gt;</strong></li> <li>Confirme e aguarde a atribuição de permissões</li></ul> <p><strong>Secret</strong></p> <ul><li>Em <strong>Certificates &amp; secrets</strong>, selecionar <strong>New client secret</strong></li> <li>Crie um secret com as seguintes propriedades:
<ul><li>Description: msgraph-secret</li> <li>Expires: 24 months</li></ul></li> <li>Add</li> <li>Após criada, obter o Value gerado</li> <li>Atribuir à propriedade <strong>b2cTenant.app.MsGraph.secret</strong> da tabela de propriedades o Value obtido anteriormente.
<strong>Atenção:</strong> o valor da secret Só poderá ser visto por inteiro quando criado.</li></ul> <h3 id="app-identityexperienceframework"><a href="#app-identityexperienceframework" class="header-anchor">#</a> App IdentityExperienceFramework</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>App registrations</strong>, selecionar <strong>New registration</strong></li> <li>Crie um App com as seguintes propriedades:
<ul><li>Name: IdentityExperienceFramework</li> <li>Supported account types: Accounts in this organizational directory only</li> <li>Redirect URI: (Web) https://{b2cTenant.Name}.b2clogin.com/{b2cTenant.Name}.onmicrosoft.com</li> <li>Permissions: Grant admin consent to openid and offline_access permissions</li></ul></li> <li>Registrar</li> <li>Na página do app criado (Overview), obter o Application (client) ID</li> <li>Atribuir à propriedade <strong>b2cTenant.app.IdentityExperienceFramework.clientId</strong> da tabela de propriedades o Application (client) ID obtido anteriormente.</li></ul> <p><strong>Scope</strong></p> <ul><li>Em <strong>Expose an API</strong>, selecionar <strong>Add a scope</strong></li> <li>Selecione Save and continue</li> <li>Crie um scope com as seguintes propriedades:
<ul><li>Scope name: user_impersonation</li> <li>Admin consent display name: Access IdentityExperienceFramework</li> <li>Admin consent description: Allow the application to access IdentityExperienceFramework on behalf of the signed-in user.</li> <li>State: Enabled</li></ul></li> <li>Selecione Add scope</li></ul> <h3 id="app-proxyidentityexperienceframework"><a href="#app-proxyidentityexperienceframework" class="header-anchor">#</a> App ProxyIdentityExperienceFramework</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>App registrations</strong>, selecionar <strong>New registration</strong></li> <li>Crie um App com as seguintes propriedades:
<ul><li>Name: ProxyIdentityExperienceFramework</li> <li>Supported account types: Accounts in this organizational directory only</li> <li>Redirect URI: (Public client/native (mobile...) myapp://auth</li> <li>Permissions: Grant admin consent to openid and offline_access permissions</li></ul></li> <li>Registrar</li> <li>Na página do app criado (Overview), obter o Application (client) ID</li> <li>Atribuir à propriedade <strong>b2cTenant.app.ProxyIdentityExperienceFramework.clientId</strong> da tabela de propriedades o Application (client) ID obtido anteriormente.</li></ul> <p><strong>Authentication</strong></p> <ul><li>Em <strong>Authentication</strong>, Advanced settings, marcar <strong>Enable the following mobile and desktop flows</strong>: Yes</li> <li>Selecione Save</li></ul> <p><strong>Permissions</strong></p> <ul><li>Em <strong>API permissions</strong>, selecionar <strong>Add a permission</strong> &gt; My APIs &gt; IdentityExperienceFramework &gt; Delegated permissions</li> <li>Buscar e selecionar a permission <strong>user_impersonation</strong></li> <li>Add permissions</li> <li>Selecione <strong>Grant admin consent for &lt;diretório&gt;</strong></li> <li>Confirme e aguarde a atribuição de permissões</li></ul> <h3 id="app-apione"><a href="#app-apione" class="header-anchor">#</a> App apione</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>App registrations</strong>, selecionar <strong>New registration</strong></li> <li>Crie um App com as seguintes propriedades:
<ul><li>Name: apione</li> <li>Supported account types: Accounts in any identity provider or organizational directory (for authenticating users with user flows)</li> <li>Redirect URI: deixar em branco</li> <li>Permissions: Grant admin consent to openid and offline_access permissions</li></ul></li> <li>Registrar</li> <li>Na página do app criado (Overview), clique no link da propriedade <strong>Managed application in local directory</strong></li> <li>Na página seguinte, obter o Object ID</li> <li>Atribuir à propriedade <strong>b2cTenant.app.Apione.EnterpriseApplication.objectId</strong> da tabela de propriedades o Object ID obtido anteriormente.</li> <li>Retorne para a página do App apione</li></ul> <p><strong>Scope</strong></p> <ul><li>Em <strong>Expose an API</strong>, selecionar <strong>Add a scope</strong></li> <li>Defina a URI: apione</li> <li>Selecione Save and continue</li> <li>Crie um scope com as seguintes propriedades:
<ul><li>Scope name: access</li> <li>Admin consent display name: access</li> <li>Admin consent description: access</li> <li>State: Enabled</li></ul></li> <li>Selecione Add scope</li></ul> <p><strong>Roles</strong></p> <ul><li>Em <strong>Manifest</strong>, editar a propriedade <strong>appRoles</strong> do json, incluindo o conteúdo do arquivo roles.json do repositório</li> <li>Salvar</li></ul> <h3 id="app-apione-viaapi-web"><a href="#app-apione-viaapi-web" class="header-anchor">#</a> App apione viaapi-web</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>App registrations</strong>, selecionar <strong>New registration</strong></li> <li>Crie um App com as seguintes propriedades:
<ul><li>Name: viaapi-web</li> <li>Supported account types: Accounts in any identity provider or organizational directory (for authenticating users with user flows)</li> <li>Redirect URI: deixar em branco</li> <li>Permissions: Grant admin consent to openid and offline_access permissions</li></ul></li> <li>Registrar</li> <li>Na página do app criado (Overview), obter o Application (client) ID</li> <li>Atribuir à propriedade <strong>b2cTenant.app.Viaapiweb.clientId</strong> da tabela de propriedades o Application (client) ID obtido anteriormente.</li></ul> <p><strong>Authentication</strong></p> <ul><li>Em <strong>Authentication</strong>, Platform configurations, selecionar Add a platform &gt; Single-page application</li> <li>Configurar com as seguintes propriedades:
<ul><li>Redirect URIs: endereço de dominio do viaapi-web. Exemplo: https://dhuo.br.engineering/</li> <li>Implicit grant and hybrid flows:
<ul><li>Access tokens (used for implicit flows)</li> <li>ID tokens (used for implicit and hybrid flows)</li></ul></li></ul></li> <li>Selecione Configure</li></ul> <p><strong>Permissions</strong></p> <ul><li>Em <strong>API permissions</strong>, selecionar <strong>Add a permission</strong> &gt; My APIs &gt; apione &gt; Delegated permissions</li> <li>Buscar e selecionar a permission <strong>access</strong></li> <li>Add permissions</li> <li>Selecione <strong>Grant admin consent for &lt;diretório&gt;</strong></li> <li>Confirme e aguarde a atribuição de permissões</li></ul> <h3 id="app-apione-apimanagement-devportal-web"><a href="#app-apione-apimanagement-devportal-web" class="header-anchor">#</a> App apione apimanagement-devportal-web</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>App registrations</strong>, selecionar <strong>New registration</strong></li> <li>Crie um App com as seguintes propriedades:
<ul><li>Name: apimanagement-devportal-web</li> <li>Supported account types: Accounts in any identity provider or organizational directory (for authenticating users with user flows)</li> <li>Redirect URI: deixar em branco</li> <li>Permissions: Grant admin consent to openid and offline_access permissions</li></ul></li> <li>Registrar</li> <li>Na página do app criado (Overview), obter o Application (client) ID</li> <li>Atribuir à propriedade <strong>b2cTenant.app.Devportalweb.clientId</strong> da tabela de propriedades o Application (client) ID obtido anteriormente.</li></ul> <p><strong>Authentication</strong></p> <ul><li>Em <strong>Authentication</strong>, Platform configurations, selecionar Add a platform &gt; Single-page application</li> <li>Configurar com as seguintes propriedades:
<ul><li>Redirect URIs: url de callback do dominio do developer portal (apimanagement-devportal-web) para a policy B2C_1A_VV_EXT_SU.
<ul><li>Formato: https://{dominio devportal}/api/auth/callback/B2C_1A_VV_EXT_SU/</li></ul></li> <li>Implicit grant and hybrid flows:
<ul><li>Access tokens (used for implicit flows)</li> <li>ID tokens (used for implicit and hybrid flows)</li></ul></li></ul></li> <li>Selecione Configure</li> <li>Na configuração da Single-page application feita anteriormente, selecionar Add URI</li> <li>Adicionar as seguintes URIs nos formatos a seguir:
<ul><li>http://{dominio devportal}/api/auth/callback/B2C_1A_VV_EXT_SUSI/</li> <li>http://{dominio devportal}/api/auth/callback/B2C_1A_VV_ProfileEdit-Native/</li></ul></li> <li>Selecione Save</li> <li>Em <strong>Authentication</strong>, Platform configurations, selecionar Add a platform &gt; Web</li> <li>Configurar com as seguintes propriedades:
<ul><li>Redirect URIs: url de callback do dominio do developer portal (apimanagement-devportal-web) para a policy B2C_1A_VV_EXT_SU.
<ul><li>Formato: https://{dominio devportal}/api/auth/callback/B2C_1A_VV_PassChange/</li></ul></li></ul></li> <li>Selecione Configure</li> <li>Na configuração da Web application feita anteriormente, selecionar Add URI</li> <li>Adicionar as seguintes URIs nos formatos a seguir:
<ul><li>http://{dominio devportal}/api/auth/callback/B2C_1A_VV_PassReset/</li></ul></li> <li>Selecione Save</li> <li>Em <strong>Authentication</strong>, Advanced settings, marcar <strong>Enable the following mobile and desktop flows</strong>: Yes</li> <li>Selecione Save</li></ul> <p><strong>Permissions</strong></p> <ul><li>Em <strong>API permissions</strong>, selecionar <strong>Add a permission</strong> &gt; My APIs &gt; apione &gt; Delegated permissions</li> <li>Buscar e selecionar a permission <strong>access</strong></li> <li>Add permissions</li> <li>Em <strong>API permissions</strong>, selecionar <strong>Add a permission</strong> &gt; My APIs &gt; IdentityExperienceFramework &gt; Delegated permissions</li> <li>Buscar e selecionar a permission <strong>user_impersonation</strong></li> <li>Add permissions</li> <li>Selecione <strong>Grant admin consent for &lt;diretório&gt;</strong></li> <li>Confirme e aguarde a atribuição de permissões</li></ul> <p><strong>Secret</strong></p> <ul><li>Em <strong>Certificates &amp; secrets</strong>, selecionar <strong>New client secret</strong></li> <li>Crie um secret com as seguintes propriedades:
<ul><li>Description: devportal-secret</li> <li>Expires: 24 months</li></ul></li> <li>Add</li> <li>Após criada, obter o Value gerado</li> <li>Atribuir à propriedade <strong>=b2cTenant.app.Devportalweb.secret</strong> da tabela de propriedades o Value obtido anteriormente.
<strong>Atenção:</strong> o valor da secret Só poderá ser visto por inteiro quando criado.</li></ul> <h3 id="app-b2c-extensions-app"><a href="#app-b2c-extensions-app" class="header-anchor">#</a> app b2c-extensions-app</h3> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>App registrations</strong>, selecionar <strong>All applications</strong></li> <li>Selecionar o app <strong>b2c-extensions-app</strong></li> <li>Na página de detalhes do app b2c-extensions-app (Overview), obter o Application (client) ID</li> <li>Atribuir à propriedade <strong>b2cTenant.app.B2CExtensionsApp.clientId</strong> da tabela de propriedades o Application (client) ID obtido anteriormente.</li> <li>Na página de detalhes do app b2c-extensions-app (Overview), obter o Object ID</li> <li>Atribuir à propriedade <strong>b2cTenant.app.B2CExtensionsApp.objectId</strong> da tabela de propriedades o Object ID obtido anteriormente.</li></ul> <h2 id="configuracao-identity-experience-framework"><a href="#configuracao-identity-experience-framework" class="header-anchor">#</a> Configuração Identity Experience Framework</h2> <p>Nesta seção são configurados secrets referenciadas no arquivos XML de custom policies que serão configuradas posteriormente.</p> <ul><li>Na página inicial do portal, busque por e selecione Azure AD B2C</li> <li>Selecionar <strong>Identity Experience Framework</strong></li> <li>Na página seguinte, selecione <strong>Policy keys</strong> e crie as seguintes keys com as seguintes propriedades:</li></ul> <h3 id="b2c-1a-adminclientencryptionkeycontainer"><a href="#b2c-1a-adminclientencryptionkeycontainer" class="header-anchor">#</a> B2C_1A_AdminClientEncryptionKeyContainer</h3> <ul><li>Options: Generate</li> <li>Name: B2C_1A_AdminClientEncryptionKeyContainer</li> <li>Key type: RSA</li> <li>Key usage: Encryption</li></ul> <h3 id="b2c-1a-tokensigningkeycontainer"><a href="#b2c-1a-tokensigningkeycontainer" class="header-anchor">#</a> B2C_1A_TokenSigningKeyContainer</h3> <ul><li>Options: Generate</li> <li>Name: B2C_1A_TokenSigningKeyContainer</li> <li>Key type: RSA</li> <li>Key usage: Signature</li></ul> <h3 id="b2c-1a-tokenencryptionkeycontainer"><a href="#b2c-1a-tokenencryptionkeycontainer" class="header-anchor">#</a> B2C_1A_TokenEncryptionKeyContainer</h3> <ul><li>Options: Generate</li> <li>Name: B2C_1A_TokenEncryptionKeyContainer</li> <li>Key type: RSA</li> <li>Key usage: Encryption</li></ul> <h3 id="b2c-1a-googlesecret"><a href="#b2c-1a-googlesecret" class="header-anchor">#</a> B2C_1A_GoogleSecret</h3> <ul><li>Options: Manual</li> <li>Name: B2C_1A_GoogleSecret</li> <li>Secret: B2C_1A_GoogleSecret</li> <li>Key usage: Encryption</li></ul> <h3 id="b2c-1a-facebooksecret"><a href="#b2c-1a-facebooksecret" class="header-anchor">#</a> B2C_1A_FacebookSecret</h3> <ul><li>Options: Manual</li> <li>Name: B2C_1A_FacebookSecret</li> <li>Secret: B2C_1A_FacebookSecret</li> <li>Key usage: Encryption</li></ul> <h3 id="b2c-1a-getusergroupsrestapiusername"><a href="#b2c-1a-getusergroupsrestapiusername" class="header-anchor">#</a> B2C_1A_GetUserGroupsRestApiUsername</h3> <ul><li>Options: Manual</li> <li>Name: B2C_1A_GetUserGroupsRestApiUsername</li> <li>Secret: usuário para autenticação Basic Auth a ser cadastrado como consumer no kong para acesso a API do back-end durante a configuração Kong (back-end gateway).</li> <li>Key usage: Encryption
<strong>Observação:</strong> Atribuir à propriedade <strong>b2cTenant.PolicyKeys.RestApiUsername</strong> da tabela de propriedades o usuário cadastrado.</li></ul> <h3 id="b2c-1a-getusergroupsrestapipassword"><a href="#b2c-1a-getusergroupsrestapipassword" class="header-anchor">#</a> B2C_1A_GetUserGroupsRestApiPassword</h3> <ul><li>Options: Manual</li> <li>Name: B2C_1A_GetUserGroupsRestApiPassword</li> <li>Secret: senha para autenticação Basic Auth a ser cadastrado como consumer no kong para acesso a API do back-end durante a configuração Kong (back-end gateway).</li> <li>Key usage: Encryption
<strong>Observação:</strong> Atribuir à propriedade <strong>b2cTenant.PolicyKeys.RestApiPassword</strong> da tabela de propriedades a senha cadastrada.</li></ul> <h3 id="b2c-1a-azureadsecret"><a href="#b2c-1a-azureadsecret" class="header-anchor">#</a> B2C_1A_AzureADSecret</h3> <ul><li>Options: Manual</li> <li>Name: B2C_1A_AzureADSecret</li> <li>Secret: propriedade <strong>defaultTenant.app.InternalUser.secret</strong> da tabela de propriedades</li> <li>Key usage: Encryption</li></ul> <h1 id="gestao-de-grupos-e-usuarios"><a href="#gestao-de-grupos-e-usuarios" class="header-anchor">#</a> Gestão de grupos e usuários</h1> <p>Todos os passos dessa seção devem ser executados no tenant b2c da subscription Azure.</p> <p>Esta seção contém instruções para gerenciamento de roles de usuários e grupos.</p> <h2 id="roles"><a href="#roles" class="header-anchor">#</a> Roles</h2> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>Em <strong>Enterprise applications</strong>, selecionar <strong>All Aplications</strong> e em seguida Apply</li> <li>Busque pelo app apione</li> <li>Na página do app, vá em <strong>Users and groups</strong> e selecione Add user/group</li> <li>Em <strong>Users</strong>, pesquise pelos usuários desejados, selecione-os e em seguida Select</li> <li>Em <strong>Select a role</strong>, selecione a role desejada para ser aplicada aos usuários. Roles disponíveis:
<ul><li>Consumer API</li> <li>Devportal Admin API</li> <li>Editor API</li> <li>Operator API</li> <li>Portal internal user</li> <li>Producer API</li></ul></li> <li>Selecione Assign</li></ul> <h2 id="groups"><a href="#groups" class="header-anchor">#</a> Groups</h2> <ul><li>Na página inicial do portal, busque por e selecione Azure Active Directory</li> <li>A relação de grupos utilizadas pela aplicação está localizada em <strong>Groups</strong></li> <li>Os grupos utilizados são do tipo <strong>Security</strong>.</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/22/2021, 10:10:25 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e8dceb60.js" defer></script><script src="/assets/js/2.a347ed34.js" defer></script><script src="/assets/js/15.927014ea.js" defer></script>
  </body>
</html>
